rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Files Collection
    match /files/{fileId} {
      // Allow reading file metadata if user is authenticated
      allow get: if request.auth != null;

      // Allow creating a file document only if:
      // 1. User is authenticated
      // 2. The uploaderUid being set matches the authenticated user's UID
      allow create: if request.auth != null && request.resource.data.uploaderUid == request.auth.uid;

      // Allow deleting a file document only if:
      // 1. User is authenticated
      // 2. The authenticated user's UID matches the uploaderUid stored in the document
      allow delete: if request.auth != null && resource.data.uploaderUid == request.auth.uid;

      // Disallow updating documents for now
      allow update: if false;
    }

    // Deny access to any other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}